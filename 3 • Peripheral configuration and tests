# 🎀 ---------- Display ----------

# 🎀 Access the config file.
sudo nano /boot/firmware/config.txt

# 🎀 Make sure the top section under the "For more options" block looks exactly like this. Remove all other HyperPixel line and block you find.
# 🎀🎀🎀🎀🎀🎀🎀🎀🎀🎀
# HyperPixel 4.0 square
dtoverlay=vc4-kms-dpi-hyperpixel4sq

# Uncomment some or all of these to enable the optional hardware interfaces
dtparam=i2c_arm=off
#dtparam=i2s=on
dtparam=spi=off
# 🎀🎀🎀🎀🎀🎀🎀🎀🎀🎀

# 🎀 Run this to disable the interfaces that could clash with the HyperPixel's DPI bus, then reboot.
sudo raspi-config nonint do_i2c 1
sudo raspi-config nonint do_spi 1
sudo systemctl disable --now hyperpixel4-init.service 2>/dev/null || true  # 🎀 This is the legacy service.
sudo reboot

# 🎀 If everything works you'll see the kernel text on the screen. Yay!

# 🎀 ---------- Sound ----------

# 🎀 Speaker: Play ALSA's WAV sample once.
speaker-test -t wav -c1

# 🎀 Microphone: List all audio devices ALSA can see, then record and play back 5s of audio.
python -m sounddevice --list-devices
arecord -d 5 -r 16000 -f S16_LE test.wav && aplay test.wav

# 🎀 Tidying up: Delete the recording, then leave the venv.
rm -f test.wav
deactivate
